
clust <- withr::with_seed(1, stabilityCluster(progeny_data, k = 3, iter = 250))

test_that("stabilityCluster() generates the correct object and dimensions", {
  expect_s3_class(clust, "tbl_df")
  expect_equal(dim(clust), c(150, 4))
  expect_named(clust, c("k=1", "k=2", "k=3", "ProbK"))
  expect_true(all(dplyr::select(clust, -ProbK) <= 1))
  expect_true(all(dplyr::select(clust, -ProbK) >= 0))
})

test_that("stabilityCluster() generates the correct values", {
  out <- tibble::tibble(
           `k=1` = c(0.644, 0.62, 0.664, 0.64, 0.688,
                     0.668, 0.608, 0.636, 0.708, 0.708, 0.636, 0.64, 0.612, 0.74,
                     0.684, 0.664, 0.66, 0.64, 0.676, 0.656, 0.656, 0.644, 0.652,
                     0.692, 0.484, 0.54, 0.644, 0.624, 0.688, 0.676, 0.628,
                     0.644, 0.684, 0.368, 0.528, 0.7, 0.66, 0.624, 0.628, 0.668,
                     0.632, 0.692, 0.356, 0.7, 0.632, 0.692, 0.672, 0.664, 0.68,
                     0.648, 0.168, 0.208, 0.192, 0.184, 0.228, 0.156, 0.16,
                     0.152, 0.208, 0.228, 0.184, 0.176, 0.188, 0.252, 0.168, 0.18,
                     0.172, 0.2, 0.188, 0.204, 0.212, 0.168, 0.152, 0.2, 0.196,
                     0.188, 0.188, 0.208, 0.192, 0.196, 0.204, 0.184, 0.208,
                     0.148, 0.228, 0.164, 0.208, 0.232, 0.176, 0.228, 0.18, 0.164,
                     0.14, 0.192, 0.196, 0.164, 0.144, 0.244, 0.168, 0.192, 0.132,
                     0.144, 0.164, 0.132, 0.128, 0.14, 0.136, 0.108, 0.136,
                     0.14, 0.148, 0.136, 0.148, 0.152, 0.608, 0.168, 0.176, 0.144,
                     0.156, 0.14, 0.152, 0.172, 0.156, 0.116, 0.148, 0.196,
                     0.152, 0.172, 0.148, 0.148, 0.136, 0.168, 0.148, 0.144, 0.144,
                     0.132, 0.156, 0.16, 0.14, 0.204, 0.148, 0.164, 0.132, 0.18,
                     0.128, 0.148, 0.152, 0.168, 0.148, 0.172),
           `k=2` = c(0.168, 0.172, 0.176, 0.2, 0.156,
                     0.176, 0.204, 0.192, 0.156, 0.16, 0.152, 0.184, 0.2, 0.152,
                     0.16, 0.188, 0.16, 0.156, 0.152, 0.172, 0.168, 0.16, 0.172,
                     0.168, 0.36, 0.256, 0.188, 0.208, 0.172, 0.168, 0.176,
                     0.164, 0.164, 0.4, 0.308, 0.14, 0.16, 0.168, 0.18, 0.156, 0.188,
                     0.164, 0.412, 0.148, 0.164, 0.188, 0.16, 0.164, 0.124,
                     0.176, 0.492, 0.448, 0.46, 0.472, 0.432, 0.488, 0.488, 0.392,
                     0.444, 0.472, 0.468, 0.468, 0.492, 0.412, 0.448, 0.48,
                     0.432, 0.456, 0.468, 0.44, 0.468, 0.456, 0.364, 0.464, 0.432,
                     0.488, 0.48, 0.464, 0.456, 0.436, 0.468, 0.44, 0.448, 0.416,
                     0.46, 0.388, 0.504, 0.424, 0.484, 0.46, 0.464, 0.484,
                     0.472, 0.472, 0.46, 0.484, 0.496, 0.476, 0.476, 0.46, 0.376,
                     0.344, 0.376, 0.336, 0.396, 0.364, 0.392, 0.392, 0.368,
                     0.352, 0.38, 0.384, 0.356, 0.34, 0.204, 0.316, 0.36, 0.372,
                     0.38, 0.372, 0.384, 0.352, 0.392, 0.384, 0.372, 0.364, 0.38,
                     0.356, 0.372, 0.36, 0.364, 0.348, 0.38, 0.424, 0.368, 0.4,
                     0.352, 0.392, 0.352, 0.364, 0.392, 0.364, 0.38, 0.372, 0.356,
                     0.4, 0.396, 0.412, 0.392, 0.324),
           `k=3` = c(0.188, 0.208, 0.16, 0.16, 0.156,
                     0.156, 0.188, 0.172, 0.136, 0.132, 0.212, 0.176, 0.188, 0.108,
                     0.156, 0.148, 0.18, 0.204, 0.172, 0.172, 0.176, 0.196,
                     0.176, 0.14, 0.156, 0.204, 0.168, 0.168, 0.14, 0.156, 0.196,
                     0.192, 0.152, 0.232, 0.164, 0.16, 0.18, 0.208, 0.192, 0.176,
                     0.18, 0.144, 0.232, 0.152, 0.204, 0.12, 0.168, 0.172,
                     0.196, 0.176, 0.34, 0.344, 0.348, 0.344, 0.34, 0.356, 0.352,
                     0.456, 0.348, 0.3, 0.348, 0.356, 0.32, 0.336, 0.384, 0.34,
                     0.396, 0.344, 0.344, 0.356, 0.32, 0.376, 0.484, 0.336, 0.372,
                     0.324, 0.332, 0.328, 0.352, 0.368, 0.328, 0.376, 0.344,
                     0.436, 0.312, 0.448, 0.288, 0.344, 0.34, 0.312, 0.356, 0.352,
                     0.388, 0.336, 0.344, 0.352, 0.36, 0.28, 0.356, 0.348,
                     0.492, 0.512, 0.46, 0.532, 0.476, 0.496, 0.472, 0.5, 0.496,
                     0.508, 0.472, 0.48, 0.496, 0.508, 0.188, 0.516, 0.464, 0.484,
                     0.464, 0.488, 0.464, 0.476, 0.452, 0.5, 0.48, 0.44, 0.468,
                     0.472, 0.48, 0.492, 0.5, 0.484, 0.472, 0.432, 0.488, 0.468,
                     0.492, 0.448, 0.508, 0.432, 0.46, 0.472, 0.488, 0.448,
                     0.516, 0.452, 0.452, 0.42, 0.46, 0.504),
            ProbK = c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                     1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                     1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 1L,
                     1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L,
                     2L, 2L, 2L, 2L, 3L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                     2L, 2L, 2L, 2L, 3L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                     3L, 2L, 3L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                     2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
                     3L, 3L, 1L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
                     3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
                     3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L)
           )
  expect_equal(clust,  out)
})
